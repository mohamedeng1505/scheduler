<section class="panel slot-panel">
  <div class="panel-header">
    <div class="panel-title">
      <h2>Available slots</h2>
      <span class="badge">{{ totalHours | number: '1.0-2' }} hrs</span>
    </div>
  </div>

  <ul class="slot-list" *ngIf="slots.length; else emptySlots">
    <li
      *ngFor="let slot of sortedSlots"
      class="slot-card"
      [class.slot-full]="isSlotFull(slot.id)"
      (dragover)="tasksComponent?.allowSlotDrop($event)"
      (drop)="tasksComponent?.handleDropOnSlot($event, slot.id)"
    >
      <div class="slot-select">
        <input
          type="checkbox"
          [checked]="isSlotSelected(slot.id)"
          (change)="slotSelectionToggle.emit(slot.id)"
          [attr.aria-label]="'Select slot ' + slot.day + ' ' + slot.start + '-' + slot.end"
        />
      </div>
      <div class="slot-main">
        <div class="slot-meta">
          <span class="pill">{{ slot.day }}</span>
          <span class="hours">{{ slot.start }} - {{ slot.end }} ({{ slot.hours }}h)</span>
        </div>
        <div class="slot-tasks" *ngIf="tasksForSlot(slot.id).length; else emptySlot">
          <div
            class="task-chip"
            *ngFor="let task of tasksForSlot(slot.id)"
            [attr.data-task-id]="task.id"
            [draggable]="!(tasksComponent?.isEditing(task.id))"
            (dragstart)="tasksComponent?.handleTaskDragStart(task.id)"
            (dragend)="tasksComponent?.handleTaskDragEnd()"
          >
            <span class="task-chip-text">{{ task.name }} - {{ task.duration }}h</span>
            <button type="button" class="chip-action" (click)="tasksComponent?.deleteTask(task.id)">Delete</button>
            <button
              type="button"
              class="chip-action"
              title="Unassign from slot"
              (click)="tasksComponent?.unassignTask(task.id)"
            >
              x
            </button>
          </div>
        </div>
        <ng-template #emptySlot>
          <p class="slot-empty">Drag a task here</p>
        </ng-template>
      </div>
      <div class="slot-actions">
        <button type="button" class="link-button" (click)="slotDuplicate.emit(slot.id)">Duplicate</button>
        <button type="button" class="link-button" (click)="slotEdit.emit(slot.id)">Edit</button>
        <button type="button" class="link-button danger" (click)="slotDelete.emit(slot.id)">Delete</button>
      </div>
    </li>
  </ul>

  <ng-template #emptySlots>
    <p class="empty">No slots yet. Add your first slot above.</p>
  </ng-template>
</section>
