<div class="budget-page">
  <header class="budget-hero">
    <div class="hero-copy">
      <p class="eyebrow">Budget planner</p>
      <h1>Budget clarity, Notion-style.</h1>
      <p class="lede">
        Track every line item, map pay cycles, and keep your cash flow visible at a
        glance. Use this layout as the front end for your Notion database.
      </p>
      <div class="hero-actions">
        <button class="btn primary" type="button">Add budget item</button>
        <button class="btn ghost" type="button">Import Notion view</button>
      </div>
    </div>

    <div class="hero-side">
      <div class="month-card">
        <div>
          <p class="month-label">Active month</p>
          <h2>{{ monthLabel }}</h2>
        </div>
        <span class="sync-pill">{{ syncLabel }}</span>
      </div>

      <div class="metric-grid">
        <div class="metric-card">
          <p>Total income</p>
          <h3>{{ totalIncome | currency: 'EGP' : 'symbol' : '1.2-2' }}</h3>
          <span class="metric-note">3 income streams</span>
        </div>
        <div class="metric-card">
          <p>Planned spend</p>
          <h3>{{ totalPlanned | currency: 'EGP' : 'symbol' : '1.2-2' }}</h3>
          <span class="metric-note">7 categories</span>
        </div>
        <div class="metric-card">
          <p>Cash left</p>
          <h3>{{ cashLeft | currency: 'EGP' : 'symbol' : '1.2-2' }}</h3>
          <span class="metric-note">After planned costs</span>
        </div>
        <div class="metric-card">
          <p>Savings rate</p>
          <h3>{{ savingsRate | number: '1.2-2' }}%</h3>
          <span class="metric-note">Based on actual spend</span>
        </div>
      </div>
    </div>
  </header>

  <section class="budget-layout">
    <div class="main-column">
      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Monthly plan</p>
            <h2>Category budget</h2>
          </div>
          <div class="chip-row">
            <button class="chip active" type="button">All</button>
            <button class="chip" type="button">Paid</button>
            <button class="chip" type="button">In progress</button>
            <button class="chip" type="button">Over</button>
          </div>
        </div>

        <div class="table categories-table">
          <div class="table-row is-header">
            <div>Category</div>
            <div>Planned</div>
            <div>Actual</div>
            <div>Variance</div>
            <div>Status</div>
          </div>

          <div class="table-row" *ngFor="let category of categories; trackBy: trackByName">
            <div class="cell primary">
              <span class="table-label">Category</span>
              <div class="cell-main">
                <span class="cell-title">{{ category.name }}</span>
                <span class="cell-sub">{{ category.group }} · due {{ category.due }}</span>
              </div>
            </div>
            <div class="cell">
              <span class="table-label">Planned</span>
              <span>{{ category.planned | currency: 'EGP' : 'symbol' : '1.2-2' }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Actual</span>
              <span>{{ category.actual | currency: 'EGP' : 'symbol' : '1.2-2' }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Variance</span>
              <span
                class="variance"
                [class.negative]="category.actual > category.planned"
                [class.positive]="category.actual <= category.planned"
              >
                {{ category.planned - category.actual | currency: 'EGP' : 'symbol' : '1.2-2' }}
              </span>
            </div>
            <div class="cell">
              <span class="table-label">Status</span>
              <span class="status-chip" [ngClass]="category.status">{{ category.status }}</span>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Income</p>
            <h2>Pay cycles & inflow</h2>
          </div>
          <button class="text-link" type="button">Add stream</button>
        </div>

        <div class="table income-table">
          <div class="table-row is-header">
            <div>Stream</div>
            <div>Cadence</div>
            <div>Next pay</div>
            <div>Amount</div>
            <div>Status</div>
          </div>
          <div class="table-row" *ngFor="let income of incomeStreams; trackBy: trackByName">
            <div class="cell primary">
              <span class="table-label">Stream</span>
              <span class="cell-title">{{ income.name }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Cadence</span>
              <span>{{ income.cadence }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Next pay</span>
              <span>{{ income.nextPay }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Amount</span>
              <span>{{ income.amount | currency: 'EGP' : 'symbol' : '1.2-2' }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Status</span>
              <span class="status-chip" [ngClass]="income.status">{{ income.status }}</span>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Add expense</h2>
          </div>
        </div>
        <div class="table form-table expense-form-table">
          <div class="table-row is-header">
            <div>Account</div>
            <div>Category</div>
            <div>Subcategory</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
          </div>
          <div class="table-row">
            <div class="cell">
              <select class="table-input" [(ngModel)]="newExpense.accountId">
                <option value="" disabled>Select</option>
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <select class="table-input" [(ngModel)]="newExpense.categoryId">
                <option value="">None</option>
                <option *ngFor="let category of expenseCategories; trackBy: trackByName" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <select class="table-input" [(ngModel)]="newExpense.subcategoryId">
                <option value="">None</option>
                <option *ngFor="let subcategory of expenseSubcategories; trackBy: trackByName" [value]="subcategory.id">
                  {{ subcategory.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <input class="table-input" type="number" inputmode="decimal" [(ngModel)]="newExpense.amount" />
            </div>
            <div class="cell">
              <input class="table-input" type="date" [(ngModel)]="newExpense.date" />
            </div>
            <div class="cell">
              <input class="table-input" type="text" [(ngModel)]="newExpense.note" />
            </div>
          </div>
        </div>
        <button class="btn primary" type="button" (click)="addExpenseTransaction()">Add expense</button>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Add income</h2>
          </div>
        </div>
        <div class="table form-table income-form-table">
          <div class="table-row is-header">
            <div>Account</div>
            <div>Category</div>
            <div>Subcategory</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
          </div>
          <div class="table-row">
            <div class="cell">
              <select class="table-input" [(ngModel)]="newIncome.accountId">
                <option value="" disabled>Select</option>
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <select class="table-input" [(ngModel)]="newIncome.categoryId">
                <option value="">None</option>
                <option *ngFor="let category of incomeCategories; trackBy: trackByName" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <select class="table-input" [(ngModel)]="newIncome.subcategoryId">
                <option value="">None</option>
                <option *ngFor="let subcategory of incomeSubcategories; trackBy: trackByName" [value]="subcategory.id">
                  {{ subcategory.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <input class="table-input" type="number" inputmode="decimal" [(ngModel)]="newIncome.amount" />
            </div>
            <div class="cell">
              <input class="table-input" type="date" [(ngModel)]="newIncome.date" />
            </div>
            <div class="cell">
              <input class="table-input" type="text" [(ngModel)]="newIncome.note" />
            </div>
          </div>
        </div>
        <button class="btn primary" type="button" (click)="addIncomeTransaction()">Add income</button>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Add transfer</h2>
          </div>
        </div>
        <div class="table form-table transfer-form-table">
          <div class="table-row is-header">
            <div>From</div>
            <div>To</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
          </div>
          <div class="table-row">
            <div class="cell">
              <select class="table-input" [(ngModel)]="newTransfer.fromAccountId">
                <option value="" disabled>Select</option>
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <select class="table-input" [(ngModel)]="newTransfer.toAccountId">
                <option value="" disabled>Select</option>
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <input class="table-input" type="number" inputmode="decimal" [(ngModel)]="newTransfer.amount" />
            </div>
            <div class="cell">
              <input class="table-input" type="date" [(ngModel)]="newTransfer.date" />
            </div>
            <div class="cell">
              <input class="table-input" type="text" [(ngModel)]="newTransfer.note" />
            </div>
          </div>
        </div>
        <button class="btn primary" type="button" (click)="addTransferTransaction()">Add transfer</button>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Database</p>
            <h2>Accounts</h2>
          </div>
          <span class="pill">{{ accounts.length }} entries</span>
        </div>
        <div class="table accounts-table">
          <div class="table-row is-header">
            <div>Account</div>
            <div>Initial</div>
            <div>Balance</div>
          </div>
          <div class="table-row" *ngFor="let account of accounts; trackBy: trackByName">
            <div class="cell primary">
              <span class="table-label">Account</span>
              <span class="cell-title">{{ account.name }}</span>
            </div>
            <div class="cell">
              <span class="table-label">Initial</span>
              <span
                class="table-value editable"
                *ngIf="!account.editing"
                (click)="startEdit(account)"
              >
                {{ account.initial | number: '1.2-2' }}
              </span>
              <input
                *ngIf="account.editing"
                class="table-input"
                type="number"
                inputmode="decimal"
                [(ngModel)]="account.draft"
                (blur)="saveEdit(account)"
                (keydown.enter)="saveEdit(account)"
                (keydown.escape)="cancelEdit(account)"
              />
            </div>
            <div class="cell">
              <span class="table-label">Balance</span>
              <span>{{ getAccountBalance(account.id) | number: '1.2-2' }}</span>
            </div>
          </div>
        </div>
      </section>

      <section class="panel notes-panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Notes</p>
            <h2>Monthly review</h2>
          </div>
          <button class="text-link" type="button">Add note</button>
        </div>
        <div class="note-grid">
          <article class="note-card" *ngFor="let note of notes">
            <p>{{ note }}</p>
          </article>
          <article class="note-card muted">
            <p>Highlight any non-recurring expenses and move them to next month.</p>
          </article>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Expense transactions</h2>
          </div>
          <span class="pill">{{ expenseTransactions.length }} entries</span>
        </div>
        <div class="table transactions-table expense-transactions-table">
          <div class="table-row is-header">
            <div>Account</div>
            <div>Category</div>
            <div>Subcategory</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
            <div>Actions</div>
          </div>
          <div class="table-row" *ngFor="let tx of expenseTransactions; trackBy: trackById">
            <div class="cell">
              <span class="table-label">Account</span>
              <span *ngIf="!tx.editing">{{ getAccountName(tx.accountId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.accountId">
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Category</span>
              <span *ngIf="!tx.editing">{{ getExpenseCategoryName(tx.categoryId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.categoryId">
                <option value="">None</option>
                <option *ngFor="let category of expenseCategories; trackBy: trackByName" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Subcategory</span>
              <span *ngIf="!tx.editing">{{ getExpenseSubcategoryName(tx.subcategoryId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.subcategoryId">
                <option value="">None</option>
                <option *ngFor="let subcategory of expenseSubcategories; trackBy: trackByName" [value]="subcategory.id">
                  {{ subcategory.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Amount</span>
              <span *ngIf="!tx.editing">{{ tx.amount | number: '1.2-2' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="number" [(ngModel)]="tx.draft!.amount" />
            </div>
            <div class="cell">
              <span class="table-label">Date</span>
              <span *ngIf="!tx.editing">{{ tx.date || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="date" [(ngModel)]="tx.draft!.date" />
            </div>
            <div class="cell">
              <span class="table-label">Note</span>
              <span *ngIf="!tx.editing">{{ tx.note || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="text" [(ngModel)]="tx.draft!.note" />
            </div>
            <div class="cell">
              <span class="table-label">Actions</span>
              <button *ngIf="!tx.editing" class="text-link" type="button" (click)="startEditExpense(tx)">Edit</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="saveEditExpense(tx)">Save</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="cancelEditExpense(tx)">Cancel</button>
              <button class="text-link danger" type="button" (click)="deleteExpense(tx)">Delete</button>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Income transactions</h2>
          </div>
          <span class="pill">{{ incomeTransactions.length }} entries</span>
        </div>
        <div class="table transactions-table income-transactions-table">
          <div class="table-row is-header">
            <div>Account</div>
            <div>Category</div>
            <div>Subcategory</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
            <div>Actions</div>
          </div>
          <div class="table-row" *ngFor="let tx of incomeTransactions; trackBy: trackById">
            <div class="cell">
              <span class="table-label">Account</span>
              <span *ngIf="!tx.editing">{{ getAccountName(tx.accountId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.accountId">
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Category</span>
              <span *ngIf="!tx.editing">{{ getIncomeCategoryName(tx.categoryId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.categoryId">
                <option value="">None</option>
                <option *ngFor="let category of incomeCategories; trackBy: trackByName" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Subcategory</span>
              <span *ngIf="!tx.editing">{{ getIncomeSubcategoryName(tx.subcategoryId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.subcategoryId">
                <option value="">None</option>
                <option *ngFor="let subcategory of incomeSubcategories; trackBy: trackByName" [value]="subcategory.id">
                  {{ subcategory.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Amount</span>
              <span *ngIf="!tx.editing">{{ tx.amount | number: '1.2-2' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="number" [(ngModel)]="tx.draft!.amount" />
            </div>
            <div class="cell">
              <span class="table-label">Date</span>
              <span *ngIf="!tx.editing">{{ tx.date || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="date" [(ngModel)]="tx.draft!.date" />
            </div>
            <div class="cell">
              <span class="table-label">Note</span>
              <span *ngIf="!tx.editing">{{ tx.note || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="text" [(ngModel)]="tx.draft!.note" />
            </div>
            <div class="cell">
              <span class="table-label">Actions</span>
              <button *ngIf="!tx.editing" class="text-link" type="button" (click)="startEditIncome(tx)">Edit</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="saveEditIncome(tx)">Save</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="cancelEditIncome(tx)">Cancel</button>
              <button class="text-link danger" type="button" (click)="deleteIncome(tx)">Delete</button>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Transactions</p>
            <h2>Transfer transactions</h2>
          </div>
          <span class="pill">{{ transferTransactions.length }} entries</span>
        </div>
        <div class="table transactions-table transfer-transactions-table">
          <div class="table-row is-header">
            <div>From</div>
            <div>To</div>
            <div>Amount</div>
            <div>Date</div>
            <div>Note</div>
            <div>Actions</div>
          </div>
          <div class="table-row" *ngFor="let tx of transferTransactions; trackBy: trackById">
            <div class="cell">
              <span class="table-label">From</span>
              <span *ngIf="!tx.editing">{{ getAccountName(tx.fromAccountId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.fromAccountId">
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">To</span>
              <span *ngIf="!tx.editing">{{ getAccountName(tx.toAccountId) }}</span>
              <select *ngIf="tx.editing" class="table-input" [(ngModel)]="tx.draft!.toAccountId">
                <option *ngFor="let account of accounts; trackBy: trackByName" [value]="account.id">
                  {{ account.name }}
                </option>
              </select>
            </div>
            <div class="cell">
              <span class="table-label">Amount</span>
              <span *ngIf="!tx.editing">{{ tx.amount | number: '1.2-2' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="number" [(ngModel)]="tx.draft!.amount" />
            </div>
            <div class="cell">
              <span class="table-label">Date</span>
              <span *ngIf="!tx.editing">{{ tx.date || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="date" [(ngModel)]="tx.draft!.date" />
            </div>
            <div class="cell">
              <span class="table-label">Note</span>
              <span *ngIf="!tx.editing">{{ tx.note || '-' }}</span>
              <input *ngIf="tx.editing" class="table-input" type="text" [(ngModel)]="tx.draft!.note" />
            </div>
            <div class="cell">
              <span class="table-label">Actions</span>
              <button *ngIf="!tx.editing" class="text-link" type="button" (click)="startEditTransfer(tx)">Edit</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="saveEditTransfer(tx)">Save</button>
              <button *ngIf="tx.editing" class="text-link" type="button" (click)="cancelEditTransfer(tx)">Cancel</button>
              <button class="text-link danger" type="button" (click)="deleteTransfer(tx)">Delete</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <aside class="side-column">
      <section class="panel mini">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Upcoming</p>
            <h3>Next bills</h3>
          </div>
          <span class="pill">4 items</span>
        </div>
        <div class="bill-list">
          <article class="bill-item" *ngFor="let bill of bills; trackBy: trackByName">
            <div>
              <p class="bill-title">{{ bill.name }}</p>
              <span class="bill-sub">{{ bill.account }} · {{ bill.due }}</span>
            </div>
            <div class="bill-meta">
              <span>{{ bill.amount | currency: 'EGP' : 'symbol' : '1.2-2' }}</span>
              <span class="status-chip" [ngClass]="bill.status">{{ bill.status }}</span>
            </div>
          </article>
        </div>
      </section>

      <section class="panel mini">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Envelopes</p>
            <h3>Targets</h3>
          </div>
          <button class="text-link" type="button">Adjust</button>
        </div>
        <div class="envelope-list">
          <div class="envelope-card" *ngFor="let envelope of envelopes; trackBy: trackByName">
            <div class="envelope-head">
              <span class="envelope-title">{{ envelope.name }}</span>
              <span class="envelope-amount">
                {{ envelope.spent | currency: 'EGP' : 'symbol' : '1.2-2' }} /
                {{ envelope.target | currency: 'EGP' : 'symbol' : '1.2-2' }}
              </span>
            </div>
            <div class="progress">
              <div
                class="progress-fill"
                [ngClass]="envelope.accent"
                [style.width.%]="envelopeProgress(envelope)"
              ></div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel mini money-challenge-card">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Challenge</p>
            <h3>Money Challenge</h3>
          </div>
        </div>
        <p class="card-copy">
          Tap each amount as you save it. Every click is stored so you never lose your streak.
        </p>
        <a class="card-link" routerLink="/money-challenge">Open challenge</a>
      </section>

      <section class="panel mini rules-panel">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Rules</p>
            <h3>Spending guardrails</h3>
          </div>
        </div>
        <ul class="rules">
          <li>Keep weekly discretionary under $120.</li>
          <li>Transfer 10% of income to savings.</li>
          <li>Review recurring charges before the 20th.</li>
        </ul>
      </section>
    </aside>
  </section>
</div>

